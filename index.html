<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏Å‡∏£‡∏∞‡∏õ‡∏∏‡∏Å‡∏≠‡∏≠‡∏°‡∏™‡∏¥‡∏ô - ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏±‡∏ß</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600;700&family=Prompt:wght@300;400;500;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #FF6B35;
            --primary-light: #FF8F65;
            --secondary: #4ECDC4;
            --secondary-light: #7EDDD7;
            --accent: #FFE66D;
            --dark: #2C3E50;
            --light: #F7F9FC;
            --success: #2ECC71;
            --danger: #E74C3C;
            --parent-primary: #6C5CE7;
            --parent-secondary: #A29BFE;
            --gradient-warm: linear-gradient(135deg, #FF6B35 0%, #FFE66D 100%);
            --gradient-cool: linear-gradient(135deg, #4ECDC4 0%, #6C5CE7 100%);
            --gradient-parent: linear-gradient(135deg, #6C5CE7 0%, #A29BFE 100%);
            --shadow-soft: 0 4px 20px rgba(0,0,0,0.08);
            --shadow-medium: 0 8px 30px rgba(0,0,0,0.12);
            --shadow-hard: 0 12px 40px rgba(0,0,0,0.18);
            --radius-sm: 12px;
            --radius-md: 20px;
            --radius-lg: 30px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Prompt', 'Kanit', sans-serif;
            background: var(--light);
            min-height: 100vh;
            color: var(--dark);
            overflow-x: hidden;
        }

        /* ===== LOGIN SCREEN ===== */
        .login-screen {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            padding: 20px;
            position: relative;
            overflow: hidden;
        }

        .login-screen::before {
            content: '';
            position: absolute;
            width: 400px;
            height: 400px;
            background: rgba(255,255,255,0.1);
            border-radius: 50%;
            top: -100px;
            left: -100px;
            animation: float 6s ease-in-out infinite;
        }

        .login-screen::after {
            content: '';
            position: absolute;
            width: 300px;
            height: 300px;
            background: rgba(255,255,255,0.08);
            border-radius: 50%;
            bottom: -50px;
            right: -50px;
            animation: float 8s ease-in-out infinite reverse;
        }

        @keyframes float {
            0%, 100% { transform: translate(0, 0) rotate(0deg); }
            50% { transform: translate(30px, 30px) rotate(10deg); }
        }

        .login-container {
            background: rgba(255,255,255,0.95);
            backdrop-filter: blur(20px);
            border-radius: var(--radius-lg);
            padding: 50px 40px;
            width: 100%;
            max-width: 420px;
            box-shadow: var(--shadow-hard);
            text-align: center;
            position: relative;
            z-index: 1;
            animation: slideUp 0.6s ease-out;
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .login-logo {
            font-size: 60px;
            margin-bottom: 10px;
            animation: bounce 2s ease-in-out infinite;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .login-title {
            font-family: 'Kanit', sans-serif;
            font-size: 28px;
            font-weight: 700;
            background: var(--gradient-cool);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 8px;
        }

        .login-subtitle {
            color: #666;
            font-size: 14px;
            margin-bottom: 35px;
        }

        .role-buttons {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .role-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            padding: 20px 30px;
            border: none;
            border-radius: var(--radius-md);
            font-family: 'Prompt', sans-serif;
            font-size: 18px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .role-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: 0.5s;
        }

        .role-btn:hover::before {
            left: 100%;
        }

        .role-btn.child {
            background: var(--gradient-warm);
            color: white;
            box-shadow: 0 8px 25px rgba(255,107,53,0.35);
        }

        .role-btn.child:hover {
            transform: translateY(-3px) scale(1.02);
            box-shadow: 0 12px 35px rgba(255,107,53,0.45);
        }

        .role-btn.parent {
            background: var(--gradient-parent);
            color: white;
            box-shadow: 0 8px 25px rgba(108,92,231,0.35);
        }

        .role-btn.parent:hover {
            transform: translateY(-3px) scale(1.02);
            box-shadow: 0 12px 35px rgba(108,92,231,0.45);
        }

        .role-icon {
            font-size: 28px;
        }

        /* ===== MAIN APP ===== */
        .app-container {
            display: none;
            min-height: 100vh;
        }

        .app-container.active {
            display: block;
        }

        /* Header */
        .header {
            background: white;
            padding: 15px 20px;
            box-shadow: var(--shadow-soft);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .header-logo {
            font-size: 32px;
        }

        .header-title {
            font-family: 'Kanit', sans-serif;
            font-size: 20px;
            font-weight: 600;
        }

        .header-title.child-mode {
            background: var(--gradient-warm);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header-title.parent-mode {
            background: var(--gradient-parent);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .week-selector {
            display: flex;
            align-items: center;
            gap: 10px;
            background: var(--light);
            padding: 8px 15px;
            border-radius: var(--radius-sm);
        }

        .week-selector input {
            border: none;
            background: transparent;
            font-family: 'Prompt', sans-serif;
            font-size: 14px;
            cursor: pointer;
        }

        .logout-btn {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            padding: 8px;
            border-radius: 50%;
            transition: all 0.3s ease;
        }

        .logout-btn:hover {
            background: var(--light);
            transform: rotate(180deg);
        }

        /* Main Content */
        .main-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 25px 20px;
        }

        /* Stats Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            border-radius: var(--radius-md);
            padding: 25px;
            box-shadow: var(--shadow-soft);
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-medium);
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
        }

        .stat-card.income::before {
            background: var(--success);
        }

        .stat-card.budget::before {
            background: var(--secondary);
        }

        .stat-card.expense::before {
            background: var(--danger);
        }

        .stat-card.points::before {
            background: var(--accent);
        }

        .stat-icon {
            font-size: 40px;
            margin-bottom: 10px;
        }

        .stat-label {
            font-size: 13px;
            color: #888;
            margin-bottom: 5px;
        }

        .stat-value {
            font-family: 'Kanit', sans-serif;
            font-size: 28px;
            font-weight: 600;
        }

        .stat-value.income { color: var(--success); }
        .stat-value.budget { color: var(--secondary); }
        .stat-value.expense { color: var(--danger); }
        .stat-value.points { color: #F39C12; }

        /* Tabs */
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 25px;
            overflow-x: auto;
            padding-bottom: 5px;
        }

        .tab-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 12px 24px;
            border: none;
            border-radius: var(--radius-sm);
            font-family: 'Prompt', sans-serif;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            background: white;
            color: #666;
            white-space: nowrap;
            box-shadow: var(--shadow-soft);
        }

        .tab-btn:hover {
            background: var(--light);
        }

        .tab-btn.active {
            background: var(--gradient-warm);
            color: white;
            box-shadow: 0 8px 20px rgba(255,107,53,0.3);
        }

        .parent-mode .tab-btn.active {
            background: var(--gradient-parent);
            box-shadow: 0 8px 20px rgba(108,92,231,0.3);
        }

        /* Tab Content */
        .tab-content {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Section */
        .section {
            background: white;
            border-radius: var(--radius-md);
            padding: 25px;
            box-shadow: var(--shadow-soft);
            margin-bottom: 25px;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .section-title {
            font-family: 'Kanit', sans-serif;
            font-size: 18px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* Forms */
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .form-label {
            font-size: 13px;
            font-weight: 500;
            color: #666;
        }

        .form-input, .form-select {
            padding: 12px 16px;
            border: 2px solid #E8ECF0;
            border-radius: var(--radius-sm);
            font-family: 'Prompt', sans-serif;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .form-input:focus, .form-select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 4px rgba(255,107,53,0.1);
        }

        .parent-mode .form-input:focus, 
        .parent-mode .form-select:focus {
            border-color: var(--parent-primary);
            box-shadow: 0 0 0 4px rgba(108,92,231,0.1);
        }

        /* Buttons */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 12px 24px;
            border: none;
            border-radius: var(--radius-sm);
            font-family: 'Prompt', sans-serif;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: var(--gradient-warm);
            color: white;
            box-shadow: 0 4px 15px rgba(255,107,53,0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255,107,53,0.4);
        }

        .parent-mode .btn-primary {
            background: var(--gradient-parent);
            box-shadow: 0 4px 15px rgba(108,92,231,0.3);
        }

        .parent-mode .btn-primary:hover {
            box-shadow: 0 6px 20px rgba(108,92,231,0.4);
        }

        .btn-secondary {
            background: var(--light);
            color: var(--dark);
        }

        .btn-secondary:hover {
            background: #E8ECF0;
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-sm {
            padding: 8px 16px;
            font-size: 13px;
        }

        /* Tables & Lists */
        .data-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .data-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 15px 20px;
            background: var(--light);
            border-radius: var(--radius-sm);
            transition: all 0.3s ease;
        }

        .data-item:hover {
            background: #E8ECF0;
            transform: translateX(5px);
        }

        .data-item-left {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .data-item-icon {
            width: 45px;
            height: 45px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 12px;
            font-size: 20px;
        }

        .data-item-info h4 {
            font-size: 15px;
            font-weight: 500;
            margin-bottom: 3px;
        }

        .data-item-info p {
            font-size: 12px;
            color: #888;
        }

        .data-item-right {
            text-align: right;
        }

        .data-item-amount {
            font-family: 'Kanit', sans-serif;
            font-size: 18px;
            font-weight: 600;
        }

        .data-item-amount.expense {
            color: var(--danger);
        }

        .data-item-amount.budget {
            color: var(--secondary);
        }

        .data-item-actions {
            display: flex;
            gap: 8px;
            margin-top: 5px;
        }

        .action-btn {
            padding: 5px 10px;
            border: none;
            border-radius: 6px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .action-btn.edit {
            background: var(--secondary-light);
            color: var(--dark);
        }

        .action-btn.delete {
            background: #FADBD8;
            color: var(--danger);
        }

        /* Progress Bar */
        .progress-container {
            margin-top: 8px;
        }

        .progress-bar {
            height: 8px;
            background: #E8ECF0;
            border-radius: 10px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            border-radius: 10px;
            transition: width 0.5s ease;
        }

        .progress-fill.good {
            background: var(--success);
        }

        .progress-fill.warning {
            background: var(--accent);
        }

        .progress-fill.danger {
            background: var(--danger);
        }

        .progress-text {
            font-size: 11px;
            color: #888;
            margin-top: 4px;
        }

        /* Category Tags */
        .category-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .category-tag {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 10px 16px;
            background: var(--light);
            border-radius: var(--radius-sm);
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .category-tag:hover {
            border-color: var(--primary);
        }

        .category-tag.selected {
            background: var(--primary);
            color: white;
        }

        .category-emoji {
            font-size: 18px;
        }

        /* Missions */
        .mission-card {
            background: var(--light);
            border-radius: var(--radius-md);
            padding: 20px;
            margin-bottom: 15px;
            border-left: 4px solid var(--parent-primary);
            transition: all 0.3s ease;
        }

        .mission-card:hover {
            transform: translateX(5px);
            box-shadow: var(--shadow-soft);
        }

        .mission-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 12px;
        }

        .mission-title {
            font-weight: 600;
            font-size: 16px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .mission-points {
            background: var(--accent);
            color: var(--dark);
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 600;
        }

        .mission-desc {
            font-size: 14px;
            color: #666;
            margin-bottom: 15px;
        }

        .mission-actions {
            display: flex;
            gap: 10px;
        }

        .mission-card.completed {
            opacity: 0.7;
            border-left-color: var(--success);
        }

        .mission-card.completed .mission-title::after {
            content: '‚úÖ';
            margin-left: 10px;
        }

        /* Rewards */
        .rewards-section {
            background: linear-gradient(135deg, #FFF6E5 0%, #FFF0D6 100%);
            border-radius: var(--radius-md);
            padding: 25px;
            margin-bottom: 25px;
        }

        .rewards-title {
            font-family: 'Kanit', sans-serif;
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .reward-tiers {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
        }

        .reward-tier {
            background: white;
            border-radius: var(--radius-sm);
            padding: 20px;
            text-align: center;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .reward-tier:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-soft);
        }

        .reward-tier.active {
            border-color: var(--accent);
            background: #FFFBF0;
        }

        .reward-tier.achieved {
            border-color: var(--success);
            background: #E8F8F0;
        }

        .reward-points {
            font-family: 'Kanit', sans-serif;
            font-size: 24px;
            font-weight: 700;
            color: #F39C12;
            margin-bottom: 5px;
        }

        .reward-label {
            font-size: 12px;
            color: #888;
            margin-bottom: 8px;
        }

        .reward-bonus {
            font-weight: 600;
            color: var(--success);
            font-size: 16px;
        }

        /* Modal */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal {
            background: white;
            border-radius: var(--radius-md);
            padding: 30px;
            width: 100%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            animation: modalIn 0.3s ease;
        }

        @keyframes modalIn {
            from { opacity: 0; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1); }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }

        .modal-title {
            font-family: 'Kanit', sans-serif;
            font-size: 20px;
            font-weight: 600;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #888;
            transition: color 0.3s ease;
        }

        .modal-close:hover {
            color: var(--dark);
        }

        .modal-body {
            margin-bottom: 25px;
        }

        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 12px;
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 50px 20px;
            color: #888;
        }

        .empty-state-icon {
            font-size: 60px;
            margin-bottom: 15px;
            opacity: 0.5;
        }

        .empty-state-text {
            font-size: 16px;
        }

        /* Google Sheets Setup */
        .setup-section {
            background: linear-gradient(135deg, #E8F4FD 0%, #F0F7FF 100%);
            border-radius: var(--radius-md);
            padding: 30px;
            margin-bottom: 25px;
            border: 2px dashed #4A90D9;
        }

        .setup-title {
            font-family: 'Kanit', sans-serif;
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 15px;
            color: #2563EB;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .setup-input {
            width: 100%;
            padding: 15px;
            border: 2px solid #CBD5E1;
            border-radius: var(--radius-sm);
            font-family: 'Prompt', sans-serif;
            font-size: 14px;
            margin-bottom: 15px;
        }

        .setup-note {
            font-size: 13px;
            color: #64748B;
            line-height: 1.6;
        }

        /* Toast Notification */
        .toast {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: var(--dark);
            color: white;
            padding: 15px 25px;
            border-radius: var(--radius-sm);
            box-shadow: var(--shadow-hard);
            display: flex;
            align-items: center;
            gap: 12px;
            transform: translateY(100px);
            opacity: 0;
            transition: all 0.3s ease;
            z-index: 2000;
        }

        .toast.show {
            transform: translateY(0);
            opacity: 1;
        }

        .toast.success {
            background: var(--success);
        }

        .toast.error {
            background: var(--danger);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .login-container {
                padding: 40px 25px;
            }

            .header-content {
                flex-direction: column;
                gap: 15px;
            }

            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .tabs {
                flex-wrap: nowrap;
            }

            .tab-btn {
                padding: 10px 16px;
                font-size: 13px;
            }

            .form-grid {
                grid-template-columns: 1fr;
            }

            .data-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }

            .data-item-right {
                width: 100%;
                display: flex;
                justify-content: space-between;
                align-items: center;
            }
        }
    </style>
</head>
<body>
    <!-- Login Screen -->
    <div class="login-screen" id="loginScreen">
        <div class="login-container">
            <div class="login-logo">üê∑</div>
            <h1 class="login-title">‡∏Å‡∏£‡∏∞‡∏õ‡∏∏‡∏Å‡∏≠‡∏≠‡∏°‡∏™‡∏¥‡∏ô</h1>
            <p class="login-subtitle">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏±‡∏ß</p>
            
            <div class="role-buttons">
                <button class="role-btn child" onclick="login('child')">
                    <span class="role-icon">üë¶</span>
                    <span>‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏•‡∏π‡∏Å</span>
                </button>
                <button class="role-btn parent" onclick="showParentLogin()">
                    <span class="role-icon">üë®‚Äçüë©‚Äçüëß</span>
                    <span>‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏ú‡∏π‡πâ‡∏õ‡∏Å‡∏Ñ‡∏£‡∏≠‡∏á</span>
                </button>
            </div>

            <!-- Parent Password Form -->
            <div id="parentLoginForm" style="display: none; margin-top: 25px;">
                <div style="background: #F8F4FF; padding: 20px; border-radius: 15px; border: 2px solid var(--parent-primary);">
                    <h3 style="margin-bottom: 15px; color: var(--parent-primary);">üîê ‡πÉ‡∏™‡πà‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏ú‡∏π‡πâ‡∏õ‡∏Å‡∏Ñ‡∏£‡∏≠‡∏á</h3>
                    <input type="password" id="parentPassword" class="form-input" 
                           placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô" 
                           style="width: 100%; margin-bottom: 15px;"
                           onkeypress="if(event.key==='Enter') verifyParentPassword()">
                    <div style="display: flex; gap: 10px;">
                        <button class="btn btn-secondary" onclick="hideParentLogin()" style="flex:1;">
                            ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
                        </button>
                        <button class="btn btn-primary" onclick="verifyParentPassword()" 
                                style="flex:1; background: var(--gradient-parent);">
                            ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö
                        </button>
                    </div>
                    <p style="font-size: 12px; color: #888; margin-top: 15px; text-align: center;">
                        üí° ‡∏£‡∏´‡∏±‡∏™‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô: <strong>1234</strong><br>
                        ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÑ‡∏î‡πâ‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏ú‡∏π‡πâ‡∏õ‡∏Å‡∏Ñ‡∏£‡∏≠‡∏á
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Child App -->
    <div class="app-container" id="childApp">
        <header class="header">
            <div class="header-content">
                <div class="header-left">
                    <span class="header-logo">üê∑</span>
                    <span class="header-title child-mode">‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ ‡∏ô‡πâ‡∏≠‡∏á‡∏ô‡πâ‡∏≥‡∏´‡∏ß‡∏≤‡∏ô!</span>
                </div>
                <div class="header-right">
                    <div class="week-selector">
                        üìÖ <input type="week" id="childWeekSelect" onchange="changeWeek()">
                    </div>
                    <button class="logout-btn" onclick="logout()" title="‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö">üö™</button>
                </div>
            </div>
        </header>

        <main class="main-content">
            <!-- Stats -->
            <div class="stats-grid">
                <div class="stat-card income">
                    <div class="stat-icon">üí∞</div>
                    <div class="stat-label">‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏ô‡∏µ‡πâ</div>
                    <div class="stat-value income" id="childIncome">‡∏ø0</div>
                </div>
                <div class="stat-card budget">
                    <div class="stat-icon">üìä</div>
                    <div class="stat-label">‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡πÑ‡∏ß‡πâ</div>
                    <div class="stat-value budget" id="childBudget">‡∏ø0</div>
                </div>
                <div class="stat-card expense">
                    <div class="stat-icon">üõí</div>
                    <div class="stat-label">‡πÉ‡∏ä‡πâ‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß</div>
                    <div class="stat-value expense" id="childExpense">‡∏ø0</div>
                </div>
                <div class="stat-card points">
                    <div class="stat-icon">‚≠ê</div>
                    <div class="stat-label">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏™‡∏∞‡∏™‡∏°</div>
                    <div class="stat-value points" id="childPoints">0</div>
                </div>
            </div>

            <!-- Tabs -->
            <div class="tabs">
                <button class="tab-btn active" onclick="switchTab('plan', 'child')">
                    üìù ‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡πÄ‡∏á‡∏¥‡∏ô
                </button>
                <button class="tab-btn" onclick="switchTab('record', 'child')">
                    üìí ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢
                </button>
                <button class="tab-btn" onclick="switchTab('missions', 'child')">
                    üéØ ‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à
                </button>
                <button class="tab-btn" onclick="switchTab('categories', 'child')">
                    üè∑Ô∏è ‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà
                </button>
                <button class="tab-btn" onclick="switchTab('settings', 'child')">
                    ‚öôÔ∏è ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤
                </button>
            </div>

            <!-- Plan Tab -->
            <div class="tab-content active" id="childPlanTab">
                <div class="section">
                    <div class="section-header">
                        <h2 class="section-title">üìù ‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì</h2>
                        <button class="btn btn-primary btn-sm" onclick="openModal('addBudget')">
                            ‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÅ‡∏ú‡∏ô
                        </button>
                    </div>
                    <div class="data-list" id="budgetList">
                        <div class="empty-state">
                            <div class="empty-state-icon">üìã</div>
                            <p class="empty-state-text">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡πÄ‡∏á‡∏¥‡∏ô<br>‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡∏Å‡∏±‡∏ô‡πÄ‡∏•‡∏¢!</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Record Tab -->
            <div class="tab-content" id="childRecordTab">
                <div class="section">
                    <div class="section-header">
                        <h2 class="section-title">üìí ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</h2>
                        <button class="btn btn-primary btn-sm" onclick="openModal('addExpense')">
                            ‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢
                        </button>
                    </div>
                    <div class="data-list" id="expenseList">
                        <div class="empty-state">
                            <div class="empty-state-icon">üßæ</div>
                            <p class="empty-state-text">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢<br>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏Ç‡∏≠‡∏á‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏Å‡∏±‡∏ô‡πÄ‡∏ñ‡∏≠‡∏∞!</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Missions Tab -->
            <div class="tab-content" id="childMissionsTab">
                <!-- Rewards -->
                <div class="rewards-section">
                    <h2 class="rewards-title">üèÜ ‡πÇ‡∏ö‡∏ô‡∏±‡∏™‡∏ï‡∏≤‡∏°‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</h2>
                    <div class="reward-tiers" id="rewardTiers">
                        <!-- Rewards will be rendered here -->
                    </div>
                </div>

                <div class="section">
                    <h2 class="section-title">üéØ ‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô</h2>
                    <div id="missionsList">
                        <div class="empty-state">
                            <div class="empty-state-icon">üéÆ</div>
                            <p class="empty-state-text">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à<br>‡∏£‡∏≠‡∏ú‡∏π‡πâ‡∏õ‡∏Å‡∏Ñ‡∏£‡∏≠‡∏á‡∏°‡∏≠‡∏ö‡∏´‡∏°‡∏≤‡∏¢‡∏ô‡∏∞!</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Categories Tab -->
            <div class="tab-content" id="childCategoriesTab">
                <div class="section">
                    <div class="section-header">
                        <h2 class="section-title">üè∑Ô∏è ‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢</h2>
                        <button class="btn btn-primary btn-sm" onclick="openModal('addCategory')">
                            ‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà
                        </button>
                    </div>
                    <div class="category-grid" id="categoryList">
                        <!-- Categories will be rendered here -->
                    </div>
                </div>
            </div>

            <!-- Child Settings Tab -->
            <div class="tab-content" id="childSettingsTab">
                <div class="section">
                    <h2 class="section-title">üìä ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Google Sheets</h2>
                    <p style="color: #666; margin: 15px 0;">‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ã‡∏¥‡∏á‡∏Ñ‡πå‡∏Å‡∏±‡∏ö‡∏ú‡∏π‡πâ‡∏õ‡∏Å‡∏Ñ‡∏£‡∏≠‡∏á</p>
                    <input type="text" class="form-input" id="childSheetUrl" 
                           placeholder="‡∏ß‡∏≤‡∏á URL ‡∏Ç‡∏≠‡∏á Google Sheets ‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà..."
                           style="margin-bottom: 15px;">
                    <div style="display: flex; gap: 10px;">
                        <button class="btn btn-primary" onclick="connectSheetChild()">
                            üîó ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠
                        </button>
                        <button class="btn btn-secondary" onclick="syncNow()">
                            üîÑ ‡∏ã‡∏¥‡∏á‡∏Ñ‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                        </button>
                    </div>
                    <div id="childConnectionStatus" style="margin-top: 15px; padding: 10px; border-radius: 10px; display: none;">
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Parent App -->
    <div class="app-container parent-mode" id="parentApp">
        <header class="header">
            <div class="header-content">
                <div class="header-left">
                    <span class="header-logo">üê∑</span>
                    <span class="header-title parent-mode">‡πÅ‡∏ú‡∏á‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏ú‡∏π‡πâ‡∏õ‡∏Å‡∏Ñ‡∏£‡∏≠‡∏á</span>
                </div>
                <div class="header-right">
                    <div class="week-selector">
                        üìÖ <input type="week" id="parentWeekSelect" onchange="changeWeek()">
                    </div>
                    <button class="logout-btn" onclick="logout()" title="‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö">üö™</button>
                </div>
            </div>
        </header>

        <main class="main-content">
            <!-- Google Sheets Setup -->
            <div class="setup-section" id="setupSection">
                <h2 class="setup-title">üìä ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Google Sheets</h2>
                <input type="text" class="setup-input" id="sheetUrl" 
                       placeholder="‡∏ß‡∏≤‡∏á URL ‡∏Ç‡∏≠‡∏á Google Sheets (Web App URL) ‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà...">
                <button class="btn btn-primary" onclick="connectSheet()">üîó ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠</button>
                <p class="setup-note">
                    <strong>‡∏ß‡∏¥‡∏ò‡∏µ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤:</strong><br>
                    1. ‡∏™‡∏£‡πâ‡∏≤‡∏á Google Sheets ‡πÉ‡∏´‡∏°‡πà<br>
                    2. ‡πÑ‡∏õ‡∏ó‡∏µ‡πà Extensions > Apps Script<br>
                    3. ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÇ‡∏Ñ‡πâ‡∏î‡∏à‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡πÉ‡∏´‡πâ‡∏°‡∏≤<br>
                    4. Deploy > New deployment > Web app<br>
                    5. ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å URL ‡∏°‡∏≤‡∏ß‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà
                </p>
            </div>

            <!-- Stats -->
            <div class="stats-grid">
                <div class="stat-card income">
                    <div class="stat-icon">üíµ</div>
                    <div class="stat-label">‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏´‡πâ‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏ô‡∏µ‡πâ</div>
                    <div class="stat-value income" id="parentIncome">‡∏ø0</div>
                </div>
                <div class="stat-card budget">
                    <div class="stat-icon">üìä</div>
                    <div class="stat-label">‡∏•‡∏π‡∏Å‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡πÑ‡∏ß‡πâ</div>
                    <div class="stat-value budget" id="parentBudget">‡∏ø0</div>
                </div>
                <div class="stat-card expense">
                    <div class="stat-icon">üßæ</div>
                    <div class="stat-label">‡∏•‡∏π‡∏Å‡πÉ‡∏ä‡πâ‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß</div>
                    <div class="stat-value expense" id="parentExpense">‡∏ø0</div>
                </div>
                <div class="stat-card points">
                    <div class="stat-icon">‚≠ê</div>
                    <div class="stat-label">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏•‡∏π‡∏Å‡∏™‡∏∞‡∏™‡∏°</div>
                    <div class="stat-value points" id="parentPoints">0</div>
                </div>
            </div>

            <!-- Tabs -->
            <div class="tabs">
                <button class="tab-btn active" onclick="switchTab('allowance', 'parent')">
                    üí∞ ‡πÉ‡∏´‡πâ‡πÄ‡∏á‡∏¥‡∏ô‡∏•‡∏π‡∏Å
                </button>
                <button class="tab-btn" onclick="switchTab('missions', 'parent')">
                    üéØ ‡∏°‡∏≠‡∏ö‡∏´‡∏°‡∏≤‡∏¢‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à
                </button>
                <button class="tab-btn" onclick="switchTab('rewards', 'parent')">
                    üéÅ ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÇ‡∏ö‡∏ô‡∏±‡∏™
                </button>
                <button class="tab-btn" onclick="switchTab('overview', 'parent')">
                    üìà ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°
                </button>
                <button class="tab-btn" onclick="switchTab('settings', 'parent')">
                    ‚öôÔ∏è ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤
                </button>
            </div>

            <!-- Allowance Tab -->
            <div class="tab-content active" id="parentAllowanceTab">
                <div class="section">
                    <h2 class="section-title">üí∞ ‡πÉ‡∏´‡πâ‡πÄ‡∏á‡∏¥‡∏ô‡∏•‡∏π‡∏Å‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå</h2>
                    <div class="form-grid" style="margin-top: 20px;">
                        <div class="form-group">
                            <label class="form-label">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô (‡∏ö‡∏≤‡∏ó)</label>
                            <input type="number" class="form-input" id="allowanceAmount" 
                                   placeholder="‡πÄ‡∏ä‡πà‡∏ô 500">
                        </div>
                        <div class="form-group">
                            <label class="form-label">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</label>
                            <input type="text" class="form-input" id="allowanceNote" 
                                   placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏Ñ‡πà‡∏≤‡∏Ç‡∏ô‡∏°‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå">
                        </div>
                    </div>
                    <button class="btn btn-primary" style="margin-top: 20px;" onclick="giveAllowance()">
                        üí∏ ‡πÉ‡∏´‡πâ‡πÄ‡∏á‡∏¥‡∏ô
                    </button>
                </div>

                <div class="section">
                    <h2 class="section-title">üìú ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡πÄ‡∏á‡∏¥‡∏ô</h2>
                    <div class="data-list" id="allowanceHistory">
                        <div class="empty-state">
                            <div class="empty-state-icon">üìù</div>
                            <p class="empty-state-text">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡πÄ‡∏á‡∏¥‡∏ô</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Missions Tab -->
            <div class="tab-content" id="parentMissionsTab">
                <div class="section">
                    <div class="section-header">
                        <h2 class="section-title">üéØ ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à</h2>
                        <button class="btn btn-primary btn-sm" onclick="openModal('addMission')">
                            ‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à
                        </button>
                    </div>
                    <div id="parentMissionsList">
                        <div class="empty-state">
                            <div class="empty-state-icon">üìã</div>
                            <p class="empty-state-text">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à<br>‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à‡πÉ‡∏´‡πâ‡∏•‡∏π‡∏Å‡∏ó‡∏≥‡∏Å‡∏±‡∏ô‡πÄ‡∏ñ‡∏≠‡∏∞!</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Rewards Tab -->
            <div class="tab-content" id="parentRewardsTab">
                <div class="section">
                    <div class="section-header">
                        <h2 class="section-title">üéÅ ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÇ‡∏ö‡∏ô‡∏±‡∏™‡∏ï‡∏≤‡∏°‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</h2>
                        <button class="btn btn-primary btn-sm" onclick="openModal('addReward')">
                            ‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏∞‡∏î‡∏±‡∏ö‡πÇ‡∏ö‡∏ô‡∏±‡∏™
                        </button>
                    </div>
                    <div class="data-list" id="rewardSettings">
                        <div class="empty-state">
                            <div class="empty-state-icon">üèÜ</div>
                            <p class="empty-state-text">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÇ‡∏ö‡∏ô‡∏±‡∏™</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Overview Tab -->
            <div class="tab-content" id="parentOverviewTab">
                <div class="section">
                    <h2 class="section-title">üìä ‡πÅ‡∏ú‡∏ô‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏Ç‡∏≠‡∏á‡∏•‡∏π‡∏Å</h2>
                    <div class="data-list" id="parentBudgetView">
                        <div class="empty-state">
                            <div class="empty-state-icon">üìã</div>
                            <p class="empty-state-text">‡∏•‡∏π‡∏Å‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì</p>
                        </div>
                    </div>
                </div>

                <div class="section">
                    <h2 class="section-title">üßæ ‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏Ç‡∏≠‡∏á‡∏•‡∏π‡∏Å</h2>
                    <div class="data-list" id="parentExpenseView">
                        <div class="empty-state">
                            <div class="empty-state-icon">üìù</div>
                            <p class="empty-state-text">‡∏•‡∏π‡∏Å‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡πÉ‡∏ô‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏ô‡∏µ‡πâ</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Settings Tab -->
            <div class="tab-content" id="parentSettingsTab">
                <div class="section">
                    <h2 class="section-title">üîê ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏ú‡∏π‡πâ‡∏õ‡∏Å‡∏Ñ‡∏£‡∏≠‡∏á</h2>
                    <div class="form-grid" style="margin-top: 20px;">
                        <div class="form-group">
                            <label class="form-label">‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô</label>
                            <input type="password" class="form-input" id="currentPassword" 
                                   placeholder="‡πÉ‡∏™‡πà‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô">
                        </div>
                        <div class="form-group">
                            <label class="form-label">‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà</label>
                            <input type="password" class="form-input" id="newPassword" 
                                   placeholder="‡πÉ‡∏™‡πà‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà">
                        </div>
                        <div class="form-group">
                            <label class="form-label">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà</label>
                            <input type="password" class="form-input" id="confirmPassword" 
                                   placeholder="‡πÉ‡∏™‡πà‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á">
                        </div>
                    </div>
                    <button class="btn btn-primary" style="margin-top: 20px;" onclick="changePassword()">
                        üîë ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô
                    </button>
                </div>

                <div class="section">
                    <h2 class="section-title">üë∂ ‡∏ï‡∏±‡πâ‡∏á‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å</h2>
                    <div class="form-group" style="margin-top: 20px;">
                        <label class="form-label">‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡πà‡πÅ‡∏™‡∏î‡∏á‡πÉ‡∏ô‡πÅ‡∏≠‡∏õ</label>
                        <input type="text" class="form-input" id="childNameInput" 
                               placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏ô‡πâ‡∏≠‡∏á‡∏°‡∏¥‡πâ‡∏ô‡∏ó‡πå">
                    </div>
                    <button class="btn btn-primary" style="margin-top: 15px;" onclick="saveChildName()">
                        üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ä‡∏∑‡πà‡∏≠
                    </button>
                </div>

                <div class="section">
                    <h2 class="section-title">üîÑ ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</h2>
                    <p style="color: #666; margin: 15px 0;">‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏™‡∏∞‡∏™‡∏°‡∏Ç‡∏≠‡∏á‡∏•‡∏π‡∏Å‡πÄ‡∏õ‡πá‡∏ô 0 (‡πÉ‡∏ä‡πâ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡πÉ‡∏´‡∏°‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏´‡πâ‡πÇ‡∏ö‡∏ô‡∏±‡∏™‡πÅ‡∏•‡πâ‡∏ß)</p>
                    <button class="btn btn-danger" onclick="resetPoints()">
                        üóëÔ∏è ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÄ‡∏õ‡πá‡∏ô 0
                    </button>
                </div>
            </div>
        </main>
    </div>

    <!-- Modals -->
    <div class="modal-overlay" id="modalOverlay">
        <div class="modal" id="modalContent">
            <!-- Modal content will be dynamically inserted -->
        </div>
    </div>

    <!-- Toast -->
    <div class="toast" id="toast">
        <span id="toastIcon">‚úì</span>
        <span id="toastMessage">‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!</span>
    </div>

    <script>
        // ===== APP STATE =====
        let currentRole = null;
        let currentWeek = getCurrentWeek();
        let sheetUrl = localStorage.getItem('sheetUrl') || '';
        
        // ‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏ú‡∏π‡πâ‡∏õ‡∏Å‡∏Ñ‡∏£‡∏≠‡∏á (‡πÄ‡∏Å‡πá‡∏ö‡πÉ‡∏ô localStorage)
        const DEFAULT_PASSWORD = '1234';
        let parentPassword = localStorage.getItem('parentPassword') || DEFAULT_PASSWORD;
        let childName = localStorage.getItem('childName') || '‡∏ô‡πâ‡∏≠‡∏á‡∏ô‡πâ‡∏≥‡∏´‡∏ß‡∏≤‡∏ô';

        // Default Data
        let appData = {
            categories: [
                { id: 1, name: '‡∏≠‡∏≤‡∏´‡∏≤‡∏£', emoji: 'üç±' },
                { id: 2, name: '‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á', emoji: 'üöå' },
                { id: 3, name: '‡∏Ç‡∏ô‡∏°', emoji: 'üç´' },
                { id: 4, name: '‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô', emoji: '‚úèÔ∏è' },
                { id: 5, name: '‡πÄ‡∏Å‡∏°', emoji: 'üéÆ' },
                { id: 6, name: '‡∏≠‡∏∑‡πà‡∏ô‡πÜ', emoji: 'üì¶' }
            ],
            budgets: [],
            expenses: [],
            missions: [],
            rewards: [
                { id: 1, points: 50, bonus: 20 },
                { id: 2, points: 100, bonus: 50 },
                { id: 3, points: 150, bonus: 100 }
            ],
            allowances: [],
            points: 0
        };

        // ===== UTILITIES =====
        function getCurrentWeek() {
            const now = new Date();
            const year = now.getFullYear();
            const firstDay = new Date(year, 0, 1);
            const days = Math.floor((now - firstDay) / (24 * 60 * 60 * 1000));
            const week = Math.ceil((days + firstDay.getDay() + 1) / 7);
            return `${year}-W${String(week).padStart(2, '0')}`;
        }

        function formatMoney(amount) {
            return `‡∏ø${Number(amount).toLocaleString()}`;
        }

        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            const icon = document.getElementById('toastIcon');
            const msg = document.getElementById('toastMessage');
            
            icon.textContent = type === 'success' ? '‚úì' : '‚úó';
            msg.textContent = message;
            toast.className = `toast show ${type}`;
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        function generateId() {
            return Date.now() + Math.random().toString(36).substr(2, 9);
        }

        // ===== GOOGLE SHEETS INTEGRATION =====
        let isSyncing = false;

        async function syncWithSheet(action, data) {
            if (!sheetUrl || isSyncing) {
                console.log('No sheet URL configured or sync in progress, using local storage');
                return null;
            }

            isSyncing = true;
            
            try {
                // ‡πÉ‡∏ä‡πâ Google Apps Script Web App ‡∏ú‡πà‡∏≤‡∏ô JSONP-like approach
                const formData = new FormData();
                formData.append('action', action);
                formData.append('data', JSON.stringify(data));
                formData.append('week', currentWeek);

                const response = await fetch(sheetUrl, {
                    method: 'POST',
                    body: formData
                });
                
                const result = await response.json();
                isSyncing = false;
                return result;
            } catch (error) {
                console.error('Sheet sync error:', error);
                isSyncing = false;
                // ‡πÑ‡∏°‡πà‡πÅ‡∏™‡∏î‡∏á error toast ‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡∏¢‡∏±‡∏á‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏Å‡∏±‡∏ö local storage ‡πÑ‡∏î‡πâ
                return null;
            }
        }

        async function loadFromSheet() {
            if (!sheetUrl) return false;
            
            try {
                const url = `${sheetUrl}?action=getData&week=${encodeURIComponent(currentWeek)}`;
                const response = await fetch(url);
                
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                
                const data = await response.json();
                
                if (data && !data.error) {
                    // Merge data from sheet
                    if (data.categories && data.categories.length > 0) {
                        appData.categories = data.categories;
                    }
                    if (data.budgets) appData.budgets = data.budgets;
                    if (data.expenses) appData.expenses = data.expenses;
                    if (data.allowances) appData.allowances = data.allowances;
                    if (data.missions) appData.missions = data.missions;
                    if (data.rewards && data.rewards.length > 0) {
                        appData.rewards = data.rewards;
                    }
                    if (typeof data.points === 'number') {
                        appData.points = data.points;
                    }
                    
                    saveDataLocal(); // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á local storage ‡∏î‡πâ‡∏ß‡∏¢
                    return true;
                }
                return false;
            } catch (error) {
                console.error('Load from sheet error:', error);
                return false;
            }
        }

        async function connectSheet() {
            const url = document.getElementById('sheetUrl').value.trim();
            if (!url) {
                showToast('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà URL', 'error');
                return;
            }

            // ‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠
            showToast('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠...');
            
            try {
                // ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠
                const testUrl = `${url}?action=getData&week=${encodeURIComponent(currentWeek)}`;
                const response = await fetch(testUrl);
                const data = await response.json();
                
                if (data.error) {
                    throw new Error(data.error);
                }
                
                sheetUrl = url;
                localStorage.setItem('sheetUrl', url);
                
                // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Sheet
                if (data.categories || data.budgets || data.expenses) {
                    if (data.categories && data.categories.length > 0) {
                        appData.categories = data.categories;
                    }
                    if (data.budgets) appData.budgets = data.budgets;
                    if (data.expenses) appData.expenses = data.expenses;
                    if (data.allowances) appData.allowances = data.allowances;
                    if (data.missions) appData.missions = data.missions;
                    if (data.rewards && data.rewards.length > 0) {
                        appData.rewards = data.rewards;
                    }
                    if (typeof data.points === 'number') {
                        appData.points = data.points;
                    }
                    saveDataLocal();
                    renderAll();
                }
                
                showToast('‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Google Sheets ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‚úì', 'success');
                document.getElementById('setupSection').style.display = 'none';
                
            } catch (error) {
                console.error('Connection error:', error);
                showToast('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏î‡πâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö URL ‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤', 'error');
            }
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠
        async function testConnection() {
            if (!sheetUrl) {
                showToast('‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Google Sheets', 'error');
                return;
            }
            
            showToast('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏î‡∏™‡∏≠‡∏ö...');
            const success = await loadFromSheet();
            
            if (success) {
                showToast('‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏õ‡∏Å‡∏ï‡∏¥ ‚úì', 'success');
                renderAll();
            } else {
                showToast('‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏°‡∏µ‡∏õ‡∏±‡∏ç‡∏´‡∏≤', 'error');
            }
        }

        // ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Google Sheets ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏•‡∏π‡∏Å
        async function connectSheetChild() {
            const url = document.getElementById('childSheetUrl').value.trim();
            if (!url) {
                showToast('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà URL', 'error');
                return;
            }

            const statusDiv = document.getElementById('childConnectionStatus');
            statusDiv.style.display = 'block';
            statusDiv.style.background = '#FFF9E6';
            statusDiv.innerHTML = '‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠...';

            try {
                const testUrl = `${url}?action=getData&week=${encodeURIComponent(currentWeek)}`;
                const response = await fetch(testUrl);
                const data = await response.json();
                
                if (data.error) {
                    throw new Error(data.error);
                }
                
                sheetUrl = url;
                localStorage.setItem('sheetUrl', url);
                
                // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Sheet
                if (data.categories && data.categories.length > 0) {
                    appData.categories = data.categories;
                }
                if (data.budgets) appData.budgets = data.budgets;
                if (data.expenses) appData.expenses = data.expenses;
                if (data.allowances) appData.allowances = data.allowances;
                if (data.missions) appData.missions = data.missions;
                if (data.rewards && data.rewards.length > 0) {
                    appData.rewards = data.rewards;
                }
                if (typeof data.points === 'number') {
                    appData.points = data.points;
                }
                
                saveDataLocal();
                renderAll();
                
                statusDiv.style.background = '#E8F8F0';
                statusDiv.innerHTML = '‚úÖ ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ã‡∏¥‡∏á‡∏Ñ‡πå‡∏Å‡∏±‡∏ö‡∏ú‡∏π‡πâ‡∏õ‡∏Å‡∏Ñ‡∏£‡∏≠‡∏á‡πÅ‡∏•‡πâ‡∏ß';
                showToast('‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! üéâ', 'success');
                
            } catch (error) {
                console.error('Connection error:', error);
                statusDiv.style.background = '#FDEDED';
                statusDiv.innerHTML = '‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏î‡πâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö URL';
                showToast('‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'error');
            }
        }

        // ‡∏ã‡∏¥‡∏á‡∏Ñ‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
        async function syncNow() {
            if (!sheetUrl) {
                showToast('‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Google Sheets', 'error');
                return;
            }
            
            showToast('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ã‡∏¥‡∏á‡∏Ñ‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...');
            
            const success = await loadFromSheet();
            
            if (success) {
                renderAll();
                showToast('‡∏ã‡∏¥‡∏á‡∏Ñ‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‚úÖ', 'success');
            } else {
                showToast('‡∏ã‡∏¥‡∏á‡∏Ñ‡πå‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà', 'error');
            }
        }

        // ===== LOCAL STORAGE =====
        function saveDataLocal() {
            localStorage.setItem('familyBudgetData', JSON.stringify(appData));
        }

        function saveData() {
            saveDataLocal();
            // Sync ‡∏Å‡∏±‡∏ö Google Sheets ‡πÅ‡∏ö‡∏ö async (‡πÑ‡∏°‡πà block)
            if (sheetUrl) {
                syncWithSheet('saveData', appData);
            }
        }

        function loadData() {
            const saved = localStorage.getItem('familyBudgetData');
            if (saved) {
                appData = JSON.parse(saved);
            }
        }

        // ===== AUTH =====
        function showParentLogin() {
            document.getElementById('parentLoginForm').style.display = 'block';
            document.getElementById('parentPassword').focus();
        }

        function hideParentLogin() {
            document.getElementById('parentLoginForm').style.display = 'none';
            document.getElementById('parentPassword').value = '';
        }

        function verifyParentPassword() {
            const inputPassword = document.getElementById('parentPassword').value;
            
            if (inputPassword === parentPassword) {
                hideParentLogin();
                login('parent');
            } else {
                showToast('‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á', 'error');
                document.getElementById('parentPassword').value = '';
                document.getElementById('parentPassword').focus();
            }
        }

        function changePassword() {
            const current = document.getElementById('currentPassword').value;
            const newPass = document.getElementById('newPassword').value;
            const confirm = document.getElementById('confirmPassword').value;

            if (current !== parentPassword) {
                showToast('‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á', 'error');
                return;
            }

            if (newPass.length < 4) {
                showToast('‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 4 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£', 'error');
                return;
            }

            if (newPass !== confirm) {
                showToast('‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà‡πÑ‡∏°‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ô', 'error');
                return;
            }

            parentPassword = newPass;
            localStorage.setItem('parentPassword', newPass);
            
            document.getElementById('currentPassword').value = '';
            document.getElementById('newPassword').value = '';
            document.getElementById('confirmPassword').value = '';
            
            showToast('‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! üîê', 'success');
        }

        function saveChildName() {
            const name = document.getElementById('childNameInput').value.trim();
            if (!name) {
                showToast('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠', 'error');
                return;
            }
            
            childName = name;
            localStorage.setItem('childName', name);
            showToast('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');
        }

        function resetPoints() {
            if (confirm('‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÄ‡∏õ‡πá‡∏ô 0 ‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) {
                appData.points = 0;
                saveData();
                renderStats();
                renderRewards();
                showToast('‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢', 'success');
            }
        }

        function login(role) {
            currentRole = role;
            document.getElementById('loginScreen').style.display = 'none';
            
            if (role === 'child') {
                document.getElementById('childApp').classList.add('active');
                document.getElementById('childWeekSelect').value = currentWeek;
                // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å
                document.querySelector('#childApp .header-title').textContent = `‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ ${childName}!`;
                // ‡πÅ‡∏™‡∏î‡∏á URL ‡∏ó‡∏µ‡πà‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏ß‡πâ
                if (sheetUrl) {
                    document.getElementById('childSheetUrl').value = sheetUrl;
                    const statusDiv = document.getElementById('childConnectionStatus');
                    statusDiv.style.display = 'block';
                    statusDiv.style.background = '#E8F8F0';
                    statusDiv.innerHTML = '‚úÖ ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÅ‡∏•‡πâ‡∏ß';
                }
            } else {
                document.getElementById('parentApp').classList.add('active');
                document.getElementById('parentWeekSelect').value = currentWeek;
                // ‡πÇ‡∏´‡∏•‡∏î‡∏Ñ‡πà‡∏≤‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤
                document.getElementById('childNameInput').value = childName;
                if (sheetUrl) {
                    document.getElementById('setupSection').style.display = 'none';
                    document.getElementById('sheetUrl').value = sheetUrl;
                }
            }
            
            loadData();
            renderAll();
        }

        function logout() {
            currentRole = null;
            document.getElementById('childApp').classList.remove('active');
            document.getElementById('parentApp').classList.remove('active');
            document.getElementById('loginScreen').style.display = 'flex';
        }

        // ===== TAB SWITCHING =====
        function switchTab(tabName, role) {
            const prefix = role === 'child' ? 'child' : 'parent';
            
            // Update buttons
            document.querySelectorAll(`#${prefix}App .tab-btn`).forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.closest('.tab-btn').classList.add('active');
            
            // Update content
            document.querySelectorAll(`#${prefix}App .tab-content`).forEach(content => {
                content.classList.remove('active');
            });
            
            const tabId = `${prefix}${tabName.charAt(0).toUpperCase() + tabName.slice(1)}Tab`;
            document.getElementById(tabId).classList.add('active');
        }

        function changeWeek() {
            const weekInput = currentRole === 'child' ? 
                document.getElementById('childWeekSelect') : 
                document.getElementById('parentWeekSelect');
            currentWeek = weekInput.value;
            renderAll();
        }

        // ===== MODALS =====
        function openModal(type, data = null) {
            const overlay = document.getElementById('modalOverlay');
            const modal = document.getElementById('modalContent');
            
            let html = '';
            
            switch(type) {
                case 'addCategory':
                    html = `
                        <div class="modal-header">
                            <h2 class="modal-title">üè∑Ô∏è ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡πÉ‡∏´‡∏°‡πà</h2>
                            <button class="modal-close" onclick="closeModal()">√ó</button>
                        </div>
                        <div class="modal-body">
                            <div class="form-group">
                                <label class="form-label">‡∏≠‡∏µ‡πÇ‡∏°‡∏à‡∏¥</label>
                                <input type="text" class="form-input" id="categoryEmoji" 
                                       placeholder="‡πÄ‡∏ä‡πà‡∏ô üéí" maxlength="2">
                            </div>
                            <div class="form-group" style="margin-top:15px;">
                                <label class="form-label">‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</label>
                                <input type="text" class="form-input" id="categoryName" 
                                       placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏Ñ‡πà‡∏≤‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠">
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button class="btn btn-secondary" onclick="closeModal()">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                            <button class="btn btn-primary" onclick="addCategory()">‡πÄ‡∏û‡∏¥‡πà‡∏°</button>
                        </div>
                    `;
                    break;

                case 'addBudget':
                    const categoryOptions = appData.categories.map(c => 
                        `<option value="${c.id}">${c.emoji} ${c.name}</option>`
                    ).join('');
                    html = `
                        <div class="modal-header">
                            <h2 class="modal-title">üìù ‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì</h2>
                            <button class="modal-close" onclick="closeModal()">√ó</button>
                        </div>
                        <div class="modal-body">
                            <div class="form-group">
                                <label class="form-label">‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</label>
                                <select class="form-select" id="budgetCategory">
                                    ${categoryOptions}
                                </select>
                            </div>
                            <div class="form-group" style="margin-top:15px;">
                                <label class="form-label">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô (‡∏ö‡∏≤‡∏ó)</label>
                                <input type="number" class="form-input" id="budgetAmount" 
                                       placeholder="‡πÄ‡∏ä‡πà‡∏ô 350">
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button class="btn btn-secondary" onclick="closeModal()">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                            <button class="btn btn-primary" onclick="addBudget()">‡πÄ‡∏û‡∏¥‡πà‡∏°</button>
                        </div>
                    `;
                    break;

                case 'addExpense':
                    const expCategoryOptions = appData.categories.map(c => 
                        `<option value="${c.id}">${c.emoji} ${c.name}</option>`
                    ).join('');
                    html = `
                        <div class="modal-header">
                            <h2 class="modal-title">üìí ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢</h2>
                            <button class="modal-close" onclick="closeModal()">√ó</button>
                        </div>
                        <div class="modal-body">
                            <div class="form-group">
                                <label class="form-label">‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</label>
                                <select class="form-select" id="expenseCategory">
                                    ${expCategoryOptions}
                                </select>
                            </div>
                            <div class="form-group" style="margin-top:15px;">
                                <label class="form-label">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</label>
                                <input type="text" class="form-input" id="expenseDesc" 
                                       placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏Ç‡πâ‡∏≤‡∏ß‡∏ú‡∏±‡∏î‡∏Å‡∏£‡∏∞‡πÄ‡∏û‡∏£‡∏≤">
                            </div>
                            <div class="form-group" style="margin-top:15px;">
                                <label class="form-label">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô (‡∏ö‡∏≤‡∏ó)</label>
                                <input type="number" class="form-input" id="expenseAmount" 
                                       placeholder="‡πÄ‡∏ä‡πà‡∏ô 50">
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button class="btn btn-secondary" onclick="closeModal()">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                            <button class="btn btn-primary" onclick="addExpense()">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
                        </div>
                    `;
                    break;

                case 'addMission':
                    html = `
                        <div class="modal-header">
                            <h2 class="modal-title">üéØ ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à‡πÉ‡∏´‡∏°‡πà</h2>
                            <button class="modal-close" onclick="closeModal()">√ó</button>
                        </div>
                        <div class="modal-body">
                            <div class="form-group">
                                <label class="form-label">‡∏ä‡∏∑‡πà‡∏≠‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à</label>
                                <input type="text" class="form-input" id="missionTitle" 
                                       placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏•‡πâ‡∏≤‡∏á‡∏à‡∏≤‡∏ô">
                            </div>
                            <div class="form-group" style="margin-top:15px;">
                                <label class="form-label">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</label>
                                <input type="text" class="form-input" id="missionDesc" 
                                       placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏•‡πâ‡∏≤‡∏á‡∏à‡∏≤‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏Å‡∏¥‡∏ô‡∏Ç‡πâ‡∏≤‡∏ß‡πÄ‡∏¢‡πá‡∏ô">
                            </div>
                            <div class="form-group" style="margin-top:15px;">
                                <label class="form-label">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö</label>
                                <input type="number" class="form-input" id="missionPoints" 
                                       placeholder="‡πÄ‡∏ä‡πà‡∏ô 10">
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button class="btn btn-secondary" onclick="closeModal()">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                            <button class="btn btn-primary" onclick="addMission()">‡∏™‡∏£‡πâ‡∏≤‡∏á</button>
                        </div>
                    `;
                    break;

                case 'addReward':
                    html = `
                        <div class="modal-header">
                            <h2 class="modal-title">üéÅ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏∞‡∏î‡∏±‡∏ö‡πÇ‡∏ö‡∏ô‡∏±‡∏™</h2>
                            <button class="modal-close" onclick="closeModal()">√ó</button>
                        </div>
                        <div class="modal-body">
                            <div class="form-group">
                                <label class="form-label">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£</label>
                                <input type="number" class="form-input" id="rewardPoints" 
                                       placeholder="‡πÄ‡∏ä‡πà‡∏ô 100">
                            </div>
                            <div class="form-group" style="margin-top:15px;">
                                <label class="form-label">‡πÇ‡∏ö‡∏ô‡∏±‡∏™‡πÄ‡∏á‡∏¥‡∏ô (‡∏ö‡∏≤‡∏ó)</label>
                                <input type="number" class="form-input" id="rewardBonus" 
                                       placeholder="‡πÄ‡∏ä‡πà‡∏ô 50">
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button class="btn btn-secondary" onclick="closeModal()">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                            <button class="btn btn-primary" onclick="addReward()">‡πÄ‡∏û‡∏¥‡πà‡∏°</button>
                        </div>
                    `;
                    break;
            }
            
            modal.innerHTML = html;
            overlay.classList.add('active');
        }

        function closeModal() {
            document.getElementById('modalOverlay').classList.remove('active');
        }

        // ===== DATA OPERATIONS =====
        function addCategory() {
            const emoji = document.getElementById('categoryEmoji').value || 'üìå';
            const name = document.getElementById('categoryName').value.trim();
            
            if (!name) {
                showToast('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà', 'error');
                return;
            }
            
            appData.categories.push({
                id: generateId(),
                name,
                emoji
            });
            
            saveData();
            renderCategories();
            closeModal();
            showToast('‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!');
        }

        function deleteCategory(id) {
            appData.categories = appData.categories.filter(c => c.id !== id);
            saveData();
            renderCategories();
            showToast('‡∏•‡∏ö‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß');
        }

        function addBudget() {
            const categoryId = document.getElementById('budgetCategory').value;
            const amount = parseFloat(document.getElementById('budgetAmount').value);
            
            if (!amount || amount <= 0) {
                showToast('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô', 'error');
                return;
            }
            
            const category = appData.categories.find(c => c.id == categoryId);
            
            // Check if budget for this category already exists
            const existing = appData.budgets.find(b => b.categoryId == categoryId && b.week === currentWeek);
            if (existing) {
                existing.amount = amount;
            } else {
                appData.budgets.push({
                    id: generateId(),
                    categoryId,
                    categoryName: category.name,
                    categoryEmoji: category.emoji,
                    amount,
                    week: currentWeek
                });
            }
            
            saveData();
            renderBudgets();
            renderStats();
            closeModal();
            showToast('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏ú‡∏ô‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!');
        }

        function deleteBudget(id) {
            appData.budgets = appData.budgets.filter(b => b.id !== id);
            saveData();
            renderBudgets();
            renderStats();
            showToast('‡∏•‡∏ö‡πÅ‡∏ú‡∏ô‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡πÅ‡∏•‡πâ‡∏ß');
        }

        function addExpense() {
            const categoryId = document.getElementById('expenseCategory').value;
            const desc = document.getElementById('expenseDesc').value.trim();
            const amount = parseFloat(document.getElementById('expenseAmount').value);
            
            if (!desc) {
                showToast('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î', 'error');
                return;
            }
            
            if (!amount || amount <= 0) {
                showToast('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô', 'error');
                return;
            }
            
            const category = appData.categories.find(c => c.id == categoryId);
            
            appData.expenses.push({
                id: generateId(),
                categoryId,
                categoryName: category.name,
                categoryEmoji: category.emoji,
                description: desc,
                amount,
                date: new Date().toISOString(),
                week: currentWeek
            });
            
            saveData();
            renderExpenses();
            renderStats();
            closeModal();
            showToast('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!');
        }

        function deleteExpense(id) {
            appData.expenses = appData.expenses.filter(e => e.id !== id);
            saveData();
            renderExpenses();
            renderStats();
            showToast('‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡πÅ‡∏•‡πâ‡∏ß');
        }

        function giveAllowance() {
            const amount = parseFloat(document.getElementById('allowanceAmount').value);
            const note = document.getElementById('allowanceNote').value.trim() || '‡∏Ñ‡πà‡∏≤‡∏Ç‡∏ô‡∏°‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå';
            
            if (!amount || amount <= 0) {
                showToast('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô', 'error');
                return;
            }
            
            appData.allowances.push({
                id: generateId(),
                amount,
                note,
                date: new Date().toISOString(),
                week: currentWeek
            });
            
            document.getElementById('allowanceAmount').value = '';
            document.getElementById('allowanceNote').value = '';
            
            saveData();
            renderAllowances();
            renderStats();
            showToast(`‡πÉ‡∏´‡πâ‡πÄ‡∏á‡∏¥‡∏ô‡∏•‡∏π‡∏Å ${formatMoney(amount)} ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!`);
        }

        function addMission() {
            const title = document.getElementById('missionTitle').value.trim();
            const desc = document.getElementById('missionDesc').value.trim();
            const points = parseInt(document.getElementById('missionPoints').value);
            
            if (!title) {
                showToast('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à', 'error');
                return;
            }
            
            if (!points || points <= 0) {
                showToast('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô', 'error');
                return;
            }
            
            appData.missions.push({
                id: generateId(),
                title,
                description: desc,
                points,
                completed: false,
                week: currentWeek
            });
            
            saveData();
            renderMissions();
            closeModal();
            showToast('‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!');
        }

        function completeMission(id) {
            const mission = appData.missions.find(m => m.id === id);
            if (mission && !mission.completed) {
                mission.completed = true;
                appData.points += mission.points;
                saveData();
                renderMissions();
                renderStats();
                renderRewards();
                showToast(`‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö ${mission.points} ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô! üéâ`);
            }
        }

        function deleteMission(id) {
            appData.missions = appData.missions.filter(m => m.id !== id);
            saveData();
            renderMissions();
            showToast('‡∏•‡∏ö‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à‡πÅ‡∏•‡πâ‡∏ß');
        }

        function addReward() {
            const points = parseInt(document.getElementById('rewardPoints').value);
            const bonus = parseInt(document.getElementById('rewardBonus').value);
            
            if (!points || points <= 0) {
                showToast('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô', 'error');
                return;
            }
            
            if (!bonus || bonus <= 0) {
                showToast('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡πÇ‡∏ö‡∏ô‡∏±‡∏™', 'error');
                return;
            }
            
            appData.rewards.push({
                id: generateId(),
                points,
                bonus
            });
            
            appData.rewards.sort((a, b) => a.points - b.points);
            
            saveData();
            renderRewardSettings();
            renderRewards();
            closeModal();
            showToast('‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏∞‡∏î‡∏±‡∏ö‡πÇ‡∏ö‡∏ô‡∏±‡∏™‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!');
        }

        function deleteReward(id) {
            appData.rewards = appData.rewards.filter(r => r.id !== id);
            saveData();
            renderRewardSettings();
            renderRewards();
            showToast('‡∏•‡∏ö‡∏£‡∏∞‡∏î‡∏±‡∏ö‡πÇ‡∏ö‡∏ô‡∏±‡∏™‡πÅ‡∏•‡πâ‡∏ß');
        }

        // ===== RENDERING =====
        function renderAll() {
            renderStats();
            renderCategories();
            renderBudgets();
            renderExpenses();
            renderMissions();
            renderRewards();
            renderRewardSettings();
            renderAllowances();
            renderParentOverview();
        }

        function renderStats() {
            const weekAllowances = appData.allowances.filter(a => a.week === currentWeek);
            const weekBudgets = appData.budgets.filter(b => b.week === currentWeek);
            const weekExpenses = appData.expenses.filter(e => e.week === currentWeek);
            
            const totalIncome = weekAllowances.reduce((sum, a) => sum + a.amount, 0);
            const totalBudget = weekBudgets.reduce((sum, b) => sum + b.amount, 0);
            const totalExpense = weekExpenses.reduce((sum, e) => sum + e.amount, 0);
            
            // Child stats
            document.getElementById('childIncome').textContent = formatMoney(totalIncome);
            document.getElementById('childBudget').textContent = formatMoney(totalBudget);
            document.getElementById('childExpense').textContent = formatMoney(totalExpense);
            document.getElementById('childPoints').textContent = appData.points;
            
            // Parent stats
            document.getElementById('parentIncome').textContent = formatMoney(totalIncome);
            document.getElementById('parentBudget').textContent = formatMoney(totalBudget);
            document.getElementById('parentExpense').textContent = formatMoney(totalExpense);
            document.getElementById('parentPoints').textContent = appData.points;
        }

        function renderCategories() {
            const container = document.getElementById('categoryList');
            
            if (appData.categories.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üè∑Ô∏è</div>
                        <p class="empty-state-text">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = appData.categories.map(cat => `
                <div class="category-tag">
                    <span class="category-emoji">${cat.emoji}</span>
                    <span>${cat.name}</span>
                    <button class="action-btn delete" onclick="deleteCategory('${cat.id}')" 
                            style="margin-left: 5px; padding: 2px 6px;">√ó</button>
                </div>
            `).join('');
        }

        function renderBudgets() {
            const container = document.getElementById('budgetList');
            const weekBudgets = appData.budgets.filter(b => b.week === currentWeek);
            
            if (weekBudgets.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üìã</div>
                        <p class="empty-state-text">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡πÄ‡∏á‡∏¥‡∏ô<br>‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡∏Å‡∏±‡∏ô‡πÄ‡∏•‡∏¢!</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = weekBudgets.map(budget => {
                const expenses = appData.expenses.filter(e => 
                    e.categoryId == budget.categoryId && e.week === currentWeek
                );
                const spent = expenses.reduce((sum, e) => sum + e.amount, 0);
                const percent = Math.min((spent / budget.amount) * 100, 100);
                const progressClass = percent > 90 ? 'danger' : percent > 70 ? 'warning' : 'good';
                
                return `
                    <div class="data-item">
                        <div class="data-item-left">
                            <div class="data-item-icon" style="background: ${getRandomColor()}20; color: ${getRandomColor()};">
                                ${budget.categoryEmoji}
                            </div>
                            <div class="data-item-info">
                                <h4>${budget.categoryName}</h4>
                                <div class="progress-container">
                                    <div class="progress-bar">
                                        <div class="progress-fill ${progressClass}" style="width: ${percent}%"></div>
                                    </div>
                                    <div class="progress-text">‡πÉ‡∏ä‡πâ‡πÑ‡∏õ ${formatMoney(spent)} / ${formatMoney(budget.amount)}</div>
                                </div>
                            </div>
                        </div>
                        <div class="data-item-right">
                            <div class="data-item-amount budget">${formatMoney(budget.amount)}</div>
                            <div class="data-item-actions">
                                <button class="action-btn delete" onclick="deleteBudget('${budget.id}')">‡∏•‡∏ö</button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function renderExpenses() {
            const container = document.getElementById('expenseList');
            const weekExpenses = appData.expenses.filter(e => e.week === currentWeek);
            
            if (weekExpenses.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üßæ</div>
                        <p class="empty-state-text">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢<br>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏Ç‡∏≠‡∏á‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏Å‡∏±‡∏ô‡πÄ‡∏ñ‡∏≠‡∏∞!</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = weekExpenses.map(expense => {
                const date = new Date(expense.date);
                const dateStr = date.toLocaleDateString('th-TH', { 
                    weekday: 'short', 
                    day: 'numeric', 
                    month: 'short' 
                });
                
                return `
                    <div class="data-item">
                        <div class="data-item-left">
                            <div class="data-item-icon" style="background: #FADBD820;">
                                ${expense.categoryEmoji}
                            </div>
                            <div class="data-item-info">
                                <h4>${expense.description}</h4>
                                <p>${expense.categoryName} ‚Ä¢ ${dateStr}</p>
                            </div>
                        </div>
                        <div class="data-item-right">
                            <div class="data-item-amount expense">-${formatMoney(expense.amount)}</div>
                            <div class="data-item-actions">
                                <button class="action-btn delete" onclick="deleteExpense('${expense.id}')">‡∏•‡∏ö</button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function renderMissions() {
            const childContainer = document.getElementById('missionsList');
            const parentContainer = document.getElementById('parentMissionsList');
            const weekMissions = appData.missions.filter(m => m.week === currentWeek);
            
            if (weekMissions.length === 0) {
                const emptyHtml = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üéÆ</div>
                        <p class="empty-state-text">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à</p>
                    </div>
                `;
                childContainer.innerHTML = emptyHtml;
                parentContainer.innerHTML = emptyHtml;
                return;
            }
            
            const childHtml = weekMissions.map(mission => `
                <div class="mission-card ${mission.completed ? 'completed' : ''}">
                    <div class="mission-header">
                        <div class="mission-title">üéØ ${mission.title}</div>
                        <div class="mission-points">‚≠ê ${mission.points} ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</div>
                    </div>
                    <p class="mission-desc">${mission.description || '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î'}</p>
                    <div class="mission-actions">
                        ${!mission.completed ? 
                            `<button class="btn btn-success btn-sm" onclick="completeMission('${mission.id}')">
                                ‚úÖ ‡∏ó‡∏≥‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß
                            </button>` : 
                            '<span style="color: var(--success);">‚úì ‡∏ó‡∏≥‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß</span>'
                        }
                    </div>
                </div>
            `).join('');
            
            const parentHtml = weekMissions.map(mission => `
                <div class="mission-card ${mission.completed ? 'completed' : ''}">
                    <div class="mission-header">
                        <div class="mission-title">üéØ ${mission.title}</div>
                        <div class="mission-points">‚≠ê ${mission.points} ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</div>
                    </div>
                    <p class="mission-desc">${mission.description || '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î'}</p>
                    <div class="mission-actions">
                        <span style="color: ${mission.completed ? 'var(--success)' : '#888'};">
                            ${mission.completed ? '‚úì ‡∏•‡∏π‡∏Å‡∏ó‡∏≥‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß' : '‚è≥ ‡∏£‡∏≠‡∏•‡∏π‡∏Å‡∏ó‡∏≥'}
                        </span>
                        <button class="btn btn-danger btn-sm" onclick="deleteMission('${mission.id}')" 
                                style="margin-left: auto;">‡∏•‡∏ö</button>
                    </div>
                </div>
            `).join('');
            
            childContainer.innerHTML = childHtml;
            parentContainer.innerHTML = parentHtml;
        }

        function renderRewards() {
            const container = document.getElementById('rewardTiers');
            
            if (appData.rewards.length === 0) {
                container.innerHTML = '<p style="color:#888;">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÇ‡∏ö‡∏ô‡∏±‡∏™</p>';
                return;
            }
            
            container.innerHTML = appData.rewards.map(reward => {
                const achieved = appData.points >= reward.points;
                return `
                    <div class="reward-tier ${achieved ? 'achieved' : ''}">
                        <div class="reward-points">${reward.points}</div>
                        <div class="reward-label">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</div>
                        <div class="reward-bonus">+${formatMoney(reward.bonus)}</div>
                        ${achieved ? '<div style="color: var(--success); font-size: 20px; margin-top: 5px;">‚úì</div>' : ''}
                    </div>
                `;
            }).join('');
        }

        function renderRewardSettings() {
            const container = document.getElementById('rewardSettings');
            
            if (appData.rewards.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üèÜ</div>
                        <p class="empty-state-text">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÇ‡∏ö‡∏ô‡∏±‡∏™</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = appData.rewards.map(reward => `
                <div class="data-item">
                    <div class="data-item-left">
                        <div class="data-item-icon" style="background: #FFF6E5;">üèÜ</div>
                        <div class="data-item-info">
                            <h4>${reward.points} ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</h4>
                            <p>‡∏£‡∏±‡∏ö‡πÇ‡∏ö‡∏ô‡∏±‡∏™ ${formatMoney(reward.bonus)}</p>
                        </div>
                    </div>
                    <div class="data-item-right">
                        <button class="action-btn delete" onclick="deleteReward('${reward.id}')">‡∏•‡∏ö</button>
                    </div>
                </div>
            `).join('');
        }

        function renderAllowances() {
            const container = document.getElementById('allowanceHistory');
            const weekAllowances = appData.allowances.filter(a => a.week === currentWeek);
            
            if (weekAllowances.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üìù</div>
                        <p class="empty-state-text">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡πÄ‡∏á‡∏¥‡∏ô</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = weekAllowances.map(allowance => {
                const date = new Date(allowance.date);
                const dateStr = date.toLocaleDateString('th-TH', { 
                    weekday: 'short', 
                    day: 'numeric', 
                    month: 'short',
                    hour: '2-digit',
                    minute: '2-digit'
                });
                
                return `
                    <div class="data-item">
                        <div class="data-item-left">
                            <div class="data-item-icon" style="background: #E8F8F020;">üíµ</div>
                            <div class="data-item-info">
                                <h4>${allowance.note}</h4>
                                <p>${dateStr}</p>
                            </div>
                        </div>
                        <div class="data-item-right">
                            <div class="data-item-amount" style="color: var(--success);">+${formatMoney(allowance.amount)}</div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function renderParentOverview() {
            // Budget overview
            const budgetContainer = document.getElementById('parentBudgetView');
            const weekBudgets = appData.budgets.filter(b => b.week === currentWeek);
            
            if (weekBudgets.length === 0) {
                budgetContainer.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üìã</div>
                        <p class="empty-state-text">‡∏•‡∏π‡∏Å‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì</p>
                    </div>
                `;
            } else {
                budgetContainer.innerHTML = weekBudgets.map(budget => {
                    const expenses = appData.expenses.filter(e => 
                        e.categoryId == budget.categoryId && e.week === currentWeek
                    );
                    const spent = expenses.reduce((sum, e) => sum + e.amount, 0);
                    const percent = Math.min((spent / budget.amount) * 100, 100);
                    const progressClass = percent > 90 ? 'danger' : percent > 70 ? 'warning' : 'good';
                    
                    return `
                        <div class="data-item">
                            <div class="data-item-left">
                                <div class="data-item-icon" style="background: ${getRandomColor()}20;">
                                    ${budget.categoryEmoji}
                                </div>
                                <div class="data-item-info">
                                    <h4>${budget.categoryName}</h4>
                                    <div class="progress-container">
                                        <div class="progress-bar">
                                            <div class="progress-fill ${progressClass}" style="width: ${percent}%"></div>
                                        </div>
                                        <div class="progress-text">‡πÉ‡∏ä‡πâ‡πÑ‡∏õ ${formatMoney(spent)} / ${formatMoney(budget.amount)} (${percent.toFixed(0)}%)</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');
            }
            
            // Expense overview
            const expenseContainer = document.getElementById('parentExpenseView');
            const weekExpenses = appData.expenses.filter(e => e.week === currentWeek);
            
            if (weekExpenses.length === 0) {
                expenseContainer.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üìù</div>
                        <p class="empty-state-text">‡∏•‡∏π‡∏Å‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡πÉ‡∏ô‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏ô‡∏µ‡πâ</p>
                    </div>
                `;
            } else {
                expenseContainer.innerHTML = weekExpenses.map(expense => {
                    const date = new Date(expense.date);
                    const dateStr = date.toLocaleDateString('th-TH', { 
                        weekday: 'short', 
                        day: 'numeric', 
                        month: 'short' 
                    });
                    
                    return `
                        <div class="data-item">
                            <div class="data-item-left">
                                <div class="data-item-icon" style="background: #FADBD820;">
                                    ${expense.categoryEmoji}
                                </div>
                                <div class="data-item-info">
                                    <h4>${expense.description}</h4>
                                    <p>${expense.categoryName} ‚Ä¢ ${dateStr}</p>
                                </div>
                            </div>
                            <div class="data-item-right">
                                <div class="data-item-amount expense">-${formatMoney(expense.amount)}</div>
                            </div>
                        </div>
                    `;
                }).join('');
            }
        }

        function getRandomColor() {
            const colors = ['#FF6B35', '#4ECDC4', '#FFE66D', '#6C5CE7', '#E74C3C', '#2ECC71'];
            return colors[Math.floor(Math.random() * colors.length)];
        }

        // ===== CLOSE MODAL ON OUTSIDE CLICK =====
        document.getElementById('modalOverlay').addEventListener('click', function(e) {
            if (e.target === this) {
                closeModal();
            }
        });

        // ===== INITIALIZE =====
        loadData();
    </script>
</body>
</html>
